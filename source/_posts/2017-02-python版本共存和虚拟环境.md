---
title: python版本共存和虚拟环境
date: 2017-03-12 10:20:20
tags:
    - Python
---

python有很多版本，如何在同一台系统中共存这些版本而且不会冲突，是python开发者一个重要的需求，所以诞生出了Python版本管理器pyenv。另外每个Python项目都会有很多包需要导入，而另一些项目并不需要，如果所有包都加入到系统Python的包目录下的话一方面不好管理另一方面容易出现包的冲突，因此需要为每个项目建立一个虚拟的独立的Python环境就太好了，于是virtualenv和conda工具就出现了。

<!-- more -->

## python 版本
2.7.X
3.X
Anaconda2
Anaconda3
python有很多版本，如何在同一台系统中共存这些版本而且不会冲突，是python开发者一个重要的需求，所以诞生出了Python版本管理器pyenv。另外每个Python项目都会有很多包需要导入，而另一些项目并不需要，如果所有包都加入到系统Python的包目录下的话一方面不好管理另一方面容易出现包的冲突，因此需要为每个项目建立一个虚拟的独立的Python环境就太好了，于是virtualenv和conda工具就出现了。

## pyenv
pyenv是一个管理各个python版本的管理器。可以在系统里同时保留多个python版本，等需要时定义需要的版本。

[项目地址](https://github.com/pyenv/pyenv)

### 安装
看项目地址中的readme

### 使用
```
pyenv install --list
```
查看pyenv可安装的版本列表

```
pyenv install anaconda2-4.2.0
pyenv uninstall x.x.x
```
安装和卸载指定版本，会将python版本安装在`$(pyenv root)/versions/`中

```
pyenv versions
```
查看当前已经安装了的python版本。输出内容中，system关键字是系统python版本。 \*表示当前环境所处的版本。

```
pyenv global anaconda2
```
全局切换为anaconda科学计算环境(不建议这么做)，做了如果要恢复，则将最后一个参数改为--unset

```
pyenv local python3.4.1
```
当前环境接环。在当前目录以下。如果要恢复，则将最后一个参数改为--unset

## virtualenv
本来这是一个单独的软件用来虚拟一个python版本环境，让每个工作环境都有一套独立的python各自的第三方插件互不影响。然而在 pyenv 下有一个插件 pyenv-virtualenv 他可以在 pyenv 的环境下担负起 virtualenv 的事情。（如果使用的是原生python可以用这个工具，如果用的是anaconda则不用这个，用下一章说的conda工具来完成虚拟环境）

[项目地址](https://github.com/pyenv/pyenv-virtualenv)

### 安装
看项目地址中的readme

### 使用
```
pyenv virtualenv 2.7.1 env271
```
在当前目录下创建一个 python 版本为2.7.1的环境，环境名字为 env271。 这个环境的真实目录位于`~/.pyenv/versions/`

```
pyenv activate env271
```
（创建时并不激活）激活当前环境。此时已经进入虚拟环境，在当前环境下所有pip等操作都不会影响系统环境和系统路径。

```
pyenv deactivate
```
离开已激活的环境，切换回系统环境。但并没有被删除，下次依旧可以启动。

```
pyenv uninstall env271
```
删除一个环境，当然也可以到真实目录下删除文件夹。

## conda
本来不想用这个的，但是因为 pyenv-virtualenv 有一些问题，无法很好的管理conda环境，比如有一些anaconda 自带的一些命令(例如pylint)无法被使用。因此还是老老实实使用 conda 来管理虚拟环境。

### 安装
conda 是自带于 anaconda 的所以并不需要额外安装，如果在 anaconda 环境中就可以使用。conda 不仅可以进行 **环境管理**，还可以**包管理**，和对 anaconda和conda 进行**版本升级**。

### 使用
由于conda使用方法太多，因此这里罗列一些常用的主要是一些虚拟环境的命令。具体的到[官网文档](https://conda.io/docs/using/index.html)去查看一下。

首先conda工具是需要在anaconda环境下的，因此先执行`pyenv local anaconda3-4.2.0`进入anaconda环境后就可以执行conda工具了。

```
conda create --name myflakes python=x.x anaconda
conda create --help
```
创建一个虚拟环境。可以指定名字，指定包，甚至制定python(这样的话就python版本管理了所以不建议使用，python版本管理交给pyenv)，所以命令中 python=x.x 可以不写

```
conda info --envs
conda env list
```
罗列已经创建的环境，两条命令是一样的。


```
source activate myflakes //Linux,OSX
activate myflakes        //Windows
```
激活一个环境。和virtualenv一样，创建不等于激活。激活后才能真正使用虚拟环境。

```
conda remove --name myflakes --all
```
删除一个虚拟环境。


```
conda create --name flowers --clone snowflakes
```
复制一个虚拟环境。这个是个不错的好功能。

```
conda env export > environment.yml
conda env create -f environment.yml
```
conda还能吧环境配置文件导出，在另一台机器上重新读入配置文件，就能复刻你的环境了。


### 其他使用
conda 还能进行包的管理。调用的是 pip 所以也很棒。

```
conda list
conda list -n myflakes
conda search numpy //查询package
```
查看当前环境已安装包，用-n指定后，就是查看某个环境下的已安装包

```
conda install -n  myflakes numpy
conda update  -n  myflakes numpy
conda remove  -n  myflakes numpy
```
为某个指定的环境安装包，升级包，删除包。

```
conda update conda
conda update anaconda
conda update python
```
它还能升级自身和anaconda和python的版本。

它和pip一样也能设置安装包的镜像位置。其余还有能使用R命令等等，都到官网文档中搜索一下。
